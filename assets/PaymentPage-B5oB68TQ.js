import{a as p}from"./apiClient-CRu48vI1.js";import{_ as x,m as y,c as a,a as t,f as h,d as m,w as u,g as c,t as l,o as d}from"./index-Cz-_8iPr.js";const E={process(r){return p.post("/payment",r)}},N={name:"PaymentPage",data(){return{form:{customerName:"",customerSurname:"",customerEmail:"",ccNumber:"",ccExpMonth:null,ccExpYear:null,ccCvv:null},loading:!1,error:null,validationErrors:{customerName:"",customerSurname:"",cardNumber:"",expiry:"",cvv:"",email:""}}},computed:{...y(["selectedSeats","selectedEvent","selectedCategory","totalPrice"]),formatSeats(){return!this.selectedSeats||this.selectedSeats.length===0?"-":this.selectedSeats.filter(r=>r&&r.row&&r.seat).map(r=>`${r.row}${r.seat}`).join(", ")||"-"}},created(){(!this.selectedEvent||!this.selectedCategory||this.selectedSeats.length===0)&&this.$router.push("/")},methods:{validateCustomerName(){const r=this.form.customerName.trim();r?r.length<2?this.validationErrors.customerName="Ad en az 2 karakter olmalıdır":/^[a-zA-ZğüşıöçĞÜŞİÖÇ\s]+$/.test(r)?this.validationErrors.customerName="":this.validationErrors.customerName="Ad sadece harf içerebilir":this.validationErrors.customerName="Ad gereklidir"},validateCustomerSurname(){const r=this.form.customerSurname.trim();r?r.length<2?this.validationErrors.customerSurname="Soyad en az 2 karakter olmalıdır":/^[a-zA-ZğüşıöçĞÜŞİÖÇ\s]+$/.test(r)?this.validationErrors.customerSurname="":this.validationErrors.customerSurname="Soyad sadece harf içerebilir":this.validationErrors.customerSurname="Soyad gereklidir"},formatCardNumber(){var n;let r=this.form.ccNumber.replace(/\s/g,""),e=((n=r.match(/.{1,4}/g))==null?void 0:n.join(" "))||r;this.form.ccNumber=e,this.validationErrors.cardNumber&&this.validateCardNumber()},validateCardNumber(){const r=this.form.ccNumber.replace(/\s/g,"");r?r.length!==16?this.validationErrors.cardNumber="Kart numarası 16 haneli olmalıdır":/^\d+$/.test(r)?this.validationErrors.cardNumber="":this.validationErrors.cardNumber="Sadece rakam girebilirsiniz":this.validationErrors.cardNumber="Kart numarası gereklidir"},validateEmail(){const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;this.form.customerEmail?r.test(this.form.customerEmail)?this.validationErrors.email="":this.validationErrors.email="Geçerli bir e-posta adresi girin":this.validationErrors.email="E-posta gereklidir"},validateExpiry(){!this.form.ccExpMonth||!this.form.ccExpYear?this.validationErrors.expiry="Son kullanma tarihi gereklidir":this.form.ccExpMonth<1||this.form.ccExpMonth>12?this.validationErrors.expiry="Ay 1-12 arasında olmalıdır":this.form.ccExpYear<26?this.validationErrors.expiry="Geçersiz yıl":this.validationErrors.expiry=""},validateCvv(){const r=String(this.form.ccCvv);r?r.length!==3?this.validationErrors.cvv="CVV 3 haneli olmalıdır":/^\d+$/.test(r)?this.validationErrors.cvv="":this.validationErrors.cvv="Sadece rakam girebilirsiniz":this.validationErrors.cvv="CVV gereklidir"},limitCvvInput(r){const e=r.target.value;e.length>3&&(this.form.ccCvv=parseInt(e.slice(0,3))),this.validationErrors.cvv&&this.validateCvv()},async submitPayment(){if(this.validateCustomerName(),this.validateCustomerSurname(),this.validateEmail(),this.validateCardNumber(),this.validateExpiry(),this.validateCvv(),Object.values(this.validationErrors).some(e=>e!=="")){this.error="Lütfen formu eksiksiz ve doğru doldurun";return}this.loading=!0,this.error=null;try{const e={eventId:this.selectedEvent.id,eventCategoryId:this.selectedCategory.id,seats:this.selectedSeats.map(v=>v.id),customer_name:this.form.customerName,customer_surname:this.form.customerSurname,customer_email:this.form.customerEmail,cc_number:this.form.ccNumber.replace(/\s/g,""),cc_exp_month:this.form.ccExpMonth,cc_exp_year:this.form.ccExpYear,cc_cvv:this.form.ccCvv},n=await E.process(e);n.data.code===201&&n.data.status==="success"?(this.$store.dispatch("clearBooking"),this.$router.push({name:"PaymentSuccess"})):this.error=n.data.message||"Ödeme işlemi başarısız oldu."}catch(e){this.error=e.message}finally{this.loading=!1}}}},C={class:"payment-page"},k={class:"mb-6"},S={class:"max-w-4xl mx-auto"},w={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},B={class:"lg:col-span-2"},V={class:"bg-white rounded-lg shadow-lg p-8 border border-transparent"},_={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},z={key:0,class:"text-red-500 text-xs mt-1"},M={key:0,class:"text-red-500 text-xs mt-1"},P={class:"mb-6"},A={key:0,class:"text-red-500 text-xs mt-1"},Y={class:"mb-4"},I={key:0,class:"text-red-500 text-xs mt-1"},U={class:"grid grid-cols-3 gap-4 mb-6"},j={key:0,class:"text-red-500 text-xs -mt-4 mb-4"},K={key:1,class:"text-red-500 text-xs -mt-4 mb-4"},D={key:2,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},G=["disabled"],T={key:0},Z={key:1},F={class:"lg:col-span-1"},L={class:"bg-white rounded-lg shadow-lg p-6 sticky top-4 border border-transparent"},O={class:"mb-4"},q={class:"text-gray-700 font-medium mb-1"},H={class:"text-sm text-gray-600"},J={class:"border-t border-gray-200 pt-4 mb-4"},Q={class:"text-sm font-medium text-gray-700"},R={class:"border-t border-gray-200 pt-4"},W={class:"flex justify-between mb-2"},X={class:"font-medium text-gray-700"},$={class:"flex justify-between mb-2"},ee={class:"font-medium text-gray-700"},te={class:"border-t border-gray-200 pt-2 mt-2"},re={class:"flex justify-between"},se={class:"text-2xl font-bold text-indigo-600"};function ie(r,e,n,v,i,o){var f,b,g;return d(),a("div",C,[t("div",k,[t("button",{onClick:e[0]||(e[0]=s=>r.$router.back()),class:"text-indigo-600 hover:text-indigo-800 font-medium"}," ← Geri Dön ")]),t("div",S,[e[32]||(e[32]=t("h1",{class:"text-3xl font-bold text-gray-800 mb-8"},"Ödeme Bilgileri",-1)),t("div",w,[t("div",B,[t("div",V,[t("form",{onSubmit:e[17]||(e[17]=h((...s)=>o.submitPayment&&o.submitPayment(...s),["prevent"]))},[e[25]||(e[25]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Müşteri Bilgileri",-1)),t("div",_,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2"},"Ad",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.form.customerName=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Adınız",onBlur:e[2]||(e[2]=(...s)=>o.validateCustomerName&&o.validateCustomerName(...s))},null,544),[[c,i.form.customerName]]),i.validationErrors.customerName?(d(),a("p",z,l(i.validationErrors.customerName),1)):m("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2"},"Soyad",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>i.form.customerSurname=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Soyadınız",onBlur:e[4]||(e[4]=(...s)=>o.validateCustomerSurname&&o.validateCustomerSurname(...s))},null,544),[[c,i.form.customerSurname]]),i.validationErrors.customerSurname?(d(),a("p",M,l(i.validationErrors.customerSurname),1)):m("",!0)])]),t("div",P,[e[20]||(e[20]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2"},"E-posta",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>i.form.customerEmail=s),type:"email",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"ornek@email.com",onBlur:e[6]||(e[6]=(...s)=>o.validateEmail&&o.validateEmail(...s))},null,544),[[c,i.form.customerEmail]]),i.validationErrors.email?(d(),a("p",A,l(i.validationErrors.email),1)):m("",!0)]),e[26]||(e[26]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-4 mt-6"},"Kart Bilgileri",-1)),t("div",Y,[e[21]||(e[21]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2"},"Kart Numarası",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>i.form.ccNumber=s),type:"text",maxlength:"19",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"1111 1111 1111 1111",onInput:e[8]||(e[8]=(...s)=>o.formatCardNumber&&o.formatCardNumber(...s)),onBlur:e[9]||(e[9]=(...s)=>o.validateCardNumber&&o.validateCardNumber(...s))},null,544),[[c,i.form.ccNumber]]),i.validationErrors.cardNumber?(d(),a("p",I,l(i.validationErrors.cardNumber),1)):m("",!0)]),t("div",U,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2"},"Ay",-1)),u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>i.form.ccExpMonth=s),type:"number",min:"1",max:"12",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"MM",onBlur:e[11]||(e[11]=(...s)=>o.validateExpiry&&o.validateExpiry(...s))},null,544),[[c,i.form.ccExpMonth,void 0,{number:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2"},"Yıl",-1)),u(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>i.form.ccExpYear=s),type:"number",min:"26",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"YY",onBlur:e[13]||(e[13]=(...s)=>o.validateExpiry&&o.validateExpiry(...s))},null,544),[[c,i.form.ccExpYear,void 0,{number:!0}]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2"},"CVV",-1)),u(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>i.form.ccCvv=s),type:"text",maxlength:"3",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"123",onBlur:e[15]||(e[15]=(...s)=>o.validateCvv&&o.validateCvv(...s)),onInput:e[16]||(e[16]=(...s)=>o.limitCvvInput&&o.limitCvvInput(...s))},null,544),[[c,i.form.ccCvv,void 0,{number:!0}]])])]),i.validationErrors.expiry?(d(),a("p",j,l(i.validationErrors.expiry),1)):m("",!0),i.validationErrors.cvv?(d(),a("p",K,l(i.validationErrors.cvv),1)):m("",!0),i.error?(d(),a("div",D,l(i.error),1)):m("",!0),t("button",{type:"submit",disabled:i.loading,class:"w-full bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-indigo-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed"},[i.loading?(d(),a("span",T,"İşleniyor...")):(d(),a("span",Z,"Ödemeyi Tamamla"))],8,G)],32)])]),t("div",F,[t("div",L,[e[31]||(e[31]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Sipariş Özeti",-1)),t("div",O,[t("p",q,l((f=r.selectedEvent)==null?void 0:f.title),1),t("p",H,l((b=r.selectedCategory)==null?void 0:b.name),1)]),t("div",J,[e[27]||(e[27]=t("p",{class:"text-sm text-gray-600 mb-2"},"Koltuklar:",-1)),t("p",Q,l(o.formatSeats),1)]),t("div",R,[t("div",W,[e[28]||(e[28]=t("span",{class:"text-gray-700"},"Bilet Adedi:",-1)),t("span",X,l(r.selectedSeats.length),1)]),t("div",$,[e[29]||(e[29]=t("span",{class:"text-gray-700"},"Bilet Fiyatı:",-1)),t("span",ee,l((g=r.selectedCategory)==null?void 0:g.price)+" ₺",1)]),t("div",te,[t("div",re,[e[30]||(e[30]=t("span",{class:"text-lg font-semibold text-gray-800"},"Toplam:",-1)),t("span",se,l(r.totalPrice)+" ₺",1)])])])])])])])])}const ae=x(N,[["render",ie]]);export{ae as default};
